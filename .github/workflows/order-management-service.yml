name: Master - CI/CD
on:
  push:
    branches:
      - main
      - 'playground/workflow-for-omg-service'
jobs:
  prepare_modified_files:
    name: ðŸ—ƒ Modified modules
    runs-on: ubuntu-latest
    steps:
      - name: ðŸšª Checkout source code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: ðŸ“– Read config file
        id: config
        run: echo "config=$(jq -c . ./.github/config/modules.json)" >> $GITHUB_OUTPUT

      - name: ðŸ‘€ Get modified modules
        id: check_modified
        uses: ./.github/actions/prepare_modified
        with:
          config: ${{ steps.config.outputs.config }}
          terraform_path: 'terraform/**'
          db_migration_path: 'db-migration/**'
          common_paths: "src/**, public/**"
    
    outputs:
      modules: ${{ steps.check_modified.outputs.modified_modules }}
      is_terraform_changed: ${{ steps.check_modified.outputs.terraform == 'true' }}
      is_db_migration_changed: ${{ steps.check_modified.outputs.db_migration == 'true' }}

        

    